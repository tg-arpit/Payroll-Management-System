{% extends "base.html" %}

{% block title %}Employee Dashboard{% endblock %}

{% block content %}
<!-- Welcome Card -->
<div class="card">
    <h2 style="color: #667eea;">ðŸ‘‹ Welcome, {{ employee.name }}!</h2>
    <p style="color: #666; margin-top: 10px;">Employee ID: <strong>{{ employee.emp_id }}</strong></p>
</div>

<!-- Quick Stats -->
<div class="stats-grid">
    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <h3>{{ days_present }}</h3>
        <p>Days Present (This Month)</p>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
        <h3>â‚¹{{ "%.2f"|format(employee.base_salary) }}</h3>
        <p>Base Salary</p>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);">
        <h3>{{ employee.department or 'N/A' }}</h3>
        <p>Department</p>
    </div>
    
    <div class="stat-card" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
        <h3>{{ payslips|length }}</h3>
        <p>Total Payslips</p>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <h3 style="margin-bottom: 20px;">âš¡ Quick Actions</h3>
    
    <form method="POST" action="{{ url_for('employee_mark_attendance') }}" style="display: inline;">
        <button type="submit" class="btn btn-success" style="margin-right: 10px;">
            âœ“ Mark Today's Attendance
        </button>
    </form>
    
    <a href="{{ url_for('employee_attendance') }}" class="btn btn-primary" style="margin-right: 10px;">
        ðŸ“… View Attendance
    </a>
    
    <a href="{{ url_for('employee_payslips') }}" class="btn btn-primary">
        ðŸ’³ View Payslips
    </a>
</div>

<!-- Profile Information -->
<div class="card">
    <h3 style="margin-bottom: 20px;">ðŸ“‹ Profile Information</h3>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
            <strong>Employee ID:</strong><br>
            <span style="color: #667eea; font-size: 18px;">{{ employee.emp_id }}</span>
        </div>
        
        <div>
            <strong>Full Name:</strong><br>
            {{ employee.name }}
        </div>
        
        <div>
            <strong>Email:</strong><br>
            {{ employee.email }}
        </div>
        
        <div>
            <strong>Phone:</strong><br>
            {{ employee.phone or 'N/A' }}
        </div>
        
        <div>
            <strong>Department:</strong><br>
            {{ employee.department or 'N/A' }}
        </div>
        
        <div>
            <strong>Designation:</strong><br>
            {{ employee.designation or 'N/A' }}
        </div>
        
        <div>
            <strong>Joining Date:</strong><br>
            {{ employee.joining_date.strftime('%d-%m-%Y') if employee.joining_date else 'N/A' }}
        </div>
        
        <div>
            <strong>Status:</strong><br>
            {% if employee.status == 'Active' %}
                <span style="color: #28a745; font-weight: bold;">âœ“ Active</span>
            {% else %}
                <span style="color: #dc3545; font-weight: bold;">âœ— Inactive</span>
            {% endif %}
        </div>
    </div>
</div>

<!-- This Month Attendance -->
{% if attendance_records %}
<div class="card">
    <h3 style="margin-bottom: 20px;">ðŸ“… This Month's Attendance Summary</h3>
    
    <div style="background: #e7f3ff; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; text-align: center;">
            <div>
                <h4 style="color: #28a745; font-size: 28px;">{{ days_present }}</h4>
                <p style="color: #666;">Present</p>
            </div>
            <div>
                <h4 style="color: #dc3545; font-size: 28px;">
                    {{ attendance_records|selectattr('status', 'equalto', 'Absent')|list|length }}
                </h4>
                <p style="color: #666;">Absent</p>
            </div>
            <div>
                <h4 style="color: #ffc107; font-size: 28px;">
                    {{ attendance_records|selectattr('status', 'equalto', 'Leave')|list|length }}
                </h4>
                <p style="color: #666;">Leave</p>
            </div>
            <div>
                <h4 style="color: #17a2b8; font-size: 28px;">
                    {{ attendance_records|selectattr('status', 'equalto', 'Half-Day')|list|length }}
                </h4>
                <p style="color: #666;">Half Day</p>
            </div>
        </div>
    </div>
    
    <a href="{{ url_for('employee_attendance') }}" class="btn btn-primary">View Full History â†’</a>
</div>
{% endif %}

<!-- Recent Payslips -->
{% if payslips %}
<div class="card">
    <h3 style="margin-bottom: 20px;">ðŸ’³ Recent Payslips</h3>
    
    <table>
        <thead>
            <tr>
                <th>Month</th>
                <th>Base Salary</th>
                <th>Gross Salary</th>
                <th>Deductions</th>
                <th>Net Salary</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for payslip in payslips %}
            {% set total_deductions = payslip.epf_deduction + payslip.tds_deduction + payslip.lop_deduction %}
            <tr>
                <td><strong>{{ payslip.month }}</strong></td>
                <td>â‚¹{{ "%.2f"|format(payslip.base_salary) }}</td>
                <td>â‚¹{{ "%.2f"|format(payslip.gross_salary) }}</td>
                <td style="color: #dc3545;">-â‚¹{{ "%.2f"|format(total_deductions) }}</td>
                <td><strong style="color: #28a745;">â‚¹{{ "%.2f"|format(payslip.net_salary) }}</strong></td>
                <td>
                    <a href="{{ url_for('download_payslip', trans_id=payslip.trans_id) }}" 
                       class="btn btn-primary" 
                       style="padding: 6px 12px; font-size: 14px;">
                        ðŸ“„ Download
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div style="text-align: center; margin-top: 20px;">
        <a href="{{ url_for('employee_payslips') }}" class="btn btn-primary">View All Payslips â†’</a>
    </div>
</div>
{% endif %}
{% endblock %}