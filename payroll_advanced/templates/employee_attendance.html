{% extends "base.html" %}

{% block title %}My Attendance{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 style="color: #667eea;">üìÖ My Attendance</h2>
        
        <form method="GET" style="display: flex; gap: 10px; align-items: center;">
            <label>Month:</label>
            <input type="month" 
                   name="month" 
                   value="{{ month }}" 
                   style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            <button type="submit" class="btn btn-primary" style="padding: 8px 16px;">Filter</button>
        </form>
    </div>
    
    <!-- Summary Cards -->
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 style="font-size: 32px; margin-bottom: 10px;">{{ days_present|round|int }}</h3>
            <p>Days Present</p>
        </div>
        
        <div style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 style="font-size: 32px; margin-bottom: 10px;">
                {{ attendance_records|selectattr('status', 'equalto', 'Absent')|list|length }}
            </h3>
            <p>Absent</p>
        </div>
        
        <div style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 style="font-size: 32px; margin-bottom: 10px;">
                {{ attendance_records|selectattr('status', 'equalto', 'Leave')|list|length }}
            </h3>
            <p>Leaves</p>
        </div>
        
        <div style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 style="font-size: 32px; margin-bottom: 10px;">
                {{ attendance_records|selectattr('status', 'equalto', 'Half-Day')|list|length }}
            </h3>
            <p>Half Days</p>
        </div>
    </div>
    
    <!-- Info Message -->
    <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #667eea;">
        <strong>‚ÑπÔ∏è Note:</strong> Your attendance is marked by the administrator. You can view your attendance records below.
    </div>
    
    <!-- Attendance Records -->
    {% if attendance_records %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Day</th>
                <th>Status</th>
                <th>Check In</th>
                <th>Check Out</th>
                <th>Working Hours</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody>
            {% for record in attendance_records|sort(attribute='date', reverse=true) %}
            <tr>
                <td><strong>{{ record.date.strftime('%d-%m-%Y') }}</strong></td>
                <td>{{ record.date.strftime('%A') }}</td>
                <td>
                    {% if record.status == 'Present' %}
                        <span style="color: #28a745; font-weight: bold;">‚úì Present</span>
                    {% elif record.status == 'Absent' %}
                        <span style="color: #dc3545; font-weight: bold;">‚úó Absent</span>
                    {% elif record.status == 'Leave' %}
                        <span style="color: #ffc107; font-weight: bold;">üìÖ Leave</span>
                    {% else %}
                        <span style="color: #17a2b8; font-weight: bold;">‚è∞ Half-Day</span>
                    {% endif %}
                </td>
                <td>
                    {% if record.check_in_time %}
                        <strong style="color: #28a745;">{{ record.check_in_time.strftime('%H:%M') }}</strong>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if record.check_out_time %}
                        <strong style="color: #dc3545;">{{ record.check_out_time.strftime('%H:%M') }}</strong>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if record.check_in_time and record.check_out_time %}
                        {% set in_minutes = record.check_in_time.hour * 60 + record.check_in_time.minute %}
                        {% set out_minutes = record.check_out_time.hour * 60 + record.check_out_time.minute %}
                        {% set total_minutes = out_minutes - in_minutes %}
                        {% set hours = (total_minutes // 60)|int %}
                        {% set minutes = (total_minutes % 60)|int %}
                        <strong style="color: #667eea;">{{ hours }}h {{ minutes }}m</strong>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ record.remarks or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="text-align: center; padding: 50px; color: #999;">
        <h3>No attendance records for this month</h3>
        <p>Your attendance will be marked by the administrator</p>
    </div>
    {% endif %}
</div>
{% endblock %}