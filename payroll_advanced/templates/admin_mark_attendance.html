{% extends "base.html" %}

{% block title %}Mark Attendance{% endblock %}

{% block content %}
<div class="card">
    <h2 style="color: #667eea; margin-bottom: 30px;">ğŸ“… Mark Employee Attendance</h2>
    
    <form method="POST">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Employee Selection -->
            <div class="form-group">
                <label>ğŸ‘¤ Select Employee *</label>
                <select name="emp_id" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="">-- Select Employee --</option>
                    {% for emp in employees %}
                    <option value="{{ emp.emp_id }}">{{ emp.emp_id }} - {{ emp.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Date Selection -->
            <div class="form-group">
                <label>ğŸ“… Date *</label>
                <input type="date" name="date" required value="{{ today }}" max="{{ today }}" 
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <!-- Attendance Status -->
            <div class="form-group">
                <label>ğŸ“‹ Attendance Status *</label>
                <select name="status" required id="status" 
                        style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;">
                    <option value="">-- Select Status --</option>
                    <option value="Present" style="color: #28a745;">âœ“ Present</option>
                    <option value="Absent" style="color: #dc3545;">âœ— Absent</option>
                    <option value="Leave" style="color: #ffc107;">ğŸ“… Leave</option>
                    <option value="Half-Day" style="color: #17a2b8;">â° Half Day</option>
                </select>
            </div>
            
            <!-- Check-in Time -->
            <div class="form-group" id="checkin-field" style="display: none;">
                <label>ğŸ• Check-in Time</label>
                <input type="time" name="check_in" value="09:00"
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <!-- Check-out Time -->
            <div class="form-group" id="checkout-field" style="display: none;">
                <label>ğŸ• Check-out Time</label>
                <input type="time" name="check_out" value="18:00"
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
        </div>
        
        <!-- Remarks -->
        <div class="form-group" style="margin-top: 20px;">
            <label>ğŸ“ Remarks (Optional)</label>
            <textarea name="remarks" rows="3" placeholder="Enter any additional notes..."
                      style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
        </div>
        
        <!-- Working Hours Display -->
        <div id="working-hours" style="display: none; margin: 20px 0; padding: 15px; background: #d4edda; border-radius: 5px; border-left: 4px solid #28a745;">
            <strong>â±ï¸ Working Hours: <span id="hours-display">0 hours 0 minutes</span></strong>
        </div>
        
        <!-- Info Box -->
        <div style="margin: 20px 0; padding: 15px; background: #e7f3ff; border-radius: 5px;">
            <strong>â„¹ï¸ Attendance Status Guide:</strong>
            <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                <li><strong style="color: #28a745;">Present:</strong> Full day attendance (counted as 1 day)</li>
                <li><strong style="color: #17a2b8;">Half-Day:</strong> Partial attendance (counted as 0.5 day)</li>
                <li><strong style="color: #ffc107;">Leave:</strong> Approved leave (not counted in salary deduction)</li>
                <li><strong style="color: #dc3545;">Absent:</strong> Unauthorized absence (LOP applied)</li>
            </ul>
        </div>
        
        <!-- Buttons -->
        <div style="display: flex; gap: 15px; margin-top: 30px;">
            <button type="submit" class="btn btn-primary" style="flex: 1;">
                âœ“ Mark Attendance
            </button>
            <a href="{{ url_for('admin_attendance') }}" class="btn btn-secondary" style="flex: 1; text-align: center;">
                Cancel
            </a>
        </div>
    </form>
</div>

<script>
// Show/hide time fields based on status
document.getElementById('status').addEventListener('change', function() {
    const checkinField = document.getElementById('checkin-field');
    const checkoutField = document.getElementById('checkout-field');
    const workingHours = document.getElementById('working-hours');
    const value = this.value;
    
    if (value === 'Present' || value === 'Half-Day') {
        checkinField.style.display = 'block';
        checkoutField.style.display = 'block';
        workingHours.style.display = 'block';
        calculateWorkingHours();
    } else {
        checkinField.style.display = 'none';
        checkoutField.style.display = 'none';
        workingHours.style.display = 'none';
    }
});

// Calculate working hours
function calculateWorkingHours() {
    const checkin = document.querySelector('input[name="check_in"]').value;
    const checkout = document.querySelector('input[name="check_out"]').value;
    
    if (checkin && checkout) {
        const [inHour, inMin] = checkin.split(':').map(Number);
        const [outHour, outMin] = checkout.split(':').map(Number);
        
        let totalMinutes = (outHour * 60 + outMin) - (inHour * 60 + inMin);
        
        if (totalMinutes < 0) totalMinutes += 24 * 60;
        
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        
        document.getElementById('hours-display').textContent = `${hours} hours ${minutes} minutes`;
    }
}

document.querySelector('input[name="check_in"]').addEventListener('change', calculateWorkingHours);
document.querySelector('input[name="check_out"]').addEventListener('change', calculateWorkingHours);
</script>
{% endblock %}